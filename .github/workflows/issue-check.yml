name: Check Similar Issues

permissions:
  issues: write
  
on:
  issues:
    types: [opened]

jobs:
  check-similar:
    runs-on: ubuntu-latest
    steps:
      - name: Check for similar issues
        uses: actions/github-script@v7
        with:
          script: |
            const issueTitle = context.payload.issue.title;
            const issueNumber = context.payload.issue.number;
            const repo = context.repo.repo;
            const owner = context.repo.owner;

            // Fetch all open issues
            const { data: issues } = await github.rest.issues.listForRepo({
              owner,
              repo,
              state: "open",
              per_page: 50
            });

            const similarIssues = issues.filter(issue =>
              issue.number !== issueNumber &&
              issue.title.toLowerCase().includes(issueTitle.toLowerCase().split(" ")[0]) // Basic similarity check
            );

            if (similarIssues.length > 0) {
              let commentBody = "ðŸ” **Similar issues found:**\n";
              similarIssues.forEach(issue => {
                commentBody += `- [#${issue.number}](${issue.html_url}) - ${issue.title}\n`;
              });

              commentBody += "\nPlease check these before proceeding! ðŸš€";

              await github.rest.issues.createComment({
                owner,
                repo,
                issue_number: issueNumber,
                body: commentBody
              });
            }
